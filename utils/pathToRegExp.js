var PATH_REGEXP=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function parse(e){for(var t,r=[],n=0,o=0,a="";null!=(t=PATH_REGEXP.exec(e));){var i=t[0],p=t[1],s=t.index;if(a+=e.slice(o,s),o=s+i.length,p)a+=p[1];else{var c=e[o],u=t[2],f=t[3],l=t[4],g=t[5],h=t[6],x=t[7];a&&(r.push(a),a="");var y=null!=u&&null!=c&&c!==u,d="+"===h||"*"===h,R="?"===h||"*"===h,v=t[2]||"/",E=l||g||(x?".*":"[^"+v+"]+?");r.push({name:f||n++,prefix:u||"",delimiter:v,optional:R,repeat:d,partial:y,asterisk:!!x,pattern:escapeGroup(E)})}}return o<e.length&&(a+=e.substr(o)),a&&r.push(a),r}function compile(e){return tokensToFunction(parse(e))}function encodeURIComponentPretty(e){return encodeURI(e).replace(/[\/?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function encodeAsterisk(e){return encodeURI(e).replace(/[?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function tokensToFunction(u){for(var f=new Array(u.length),e=0;e<u.length;e++)"object"==typeof u[e]&&(f[e]=new RegExp("^(?:"+u[e].pattern+")$"));return function(e,t){for(var r="",n=e||{},o=(t||{}).pretty?encodeURIComponentPretty:encodeURIComponent,a=0;a<u.length;a++){var i=u[a];if("string"!=typeof i){var p,s=n[i.name];if(null==s){if(i.optional){i.partial&&(r+=i.prefix);continue}throw new TypeError('Expected "'+i.name+'" to be defined')}if(Array.isArray(s)){if(!i.repeat)throw new TypeError('Expected "'+i.name+'" to not repeat, but received `'+JSON.stringify(s)+"`");if(0===s.length){if(i.optional)continue;throw new TypeError('Expected "'+i.name+'" to not be empty')}for(var c=0;c<s.length;c++){if(p=o(s[c]),!f[a].test(p))throw new TypeError('Expected all "'+i.name+'" to match "'+i.pattern+'", but received `'+JSON.stringify(p)+"`");r+=(0===c?i.prefix:i.delimiter)+p}}else{if(p=(i.asterisk?encodeAsterisk:o)(s),!f[a].test(p))throw new TypeError('Expected "'+i.name+'" to match "'+i.pattern+'", but received "'+p+'"');r+=i.prefix+p}}else r+=i}return r}}function escapeString(e){return e.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function escapeGroup(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function attachKeys(e,t){return e.keys=t,e}function flags(e){return e.sensitive?"":"i"}function regexpToRegexp(e,t){var r=e.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)t.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return attachKeys(e,t)}function arrayToRegexp(e,t,r){for(var n=[],o=0;o<e.length;o++)n.push(pathToRegexp(e[o],t,r).source);return attachKeys(new RegExp("(?:"+n.join("|")+")",flags(r)),t)}function stringToRegexp(e,t,r){for(var n=parse(e),o=tokensToRegExp(n,r),a=0;a<n.length;a++)"string"!=typeof n[a]&&t.push(n[a]);return attachKeys(o,t)}function tokensToRegExp(e,t){for(var r=(t=t||{}).strict,n=!1!==t.end,o="",a=e[e.length-1],i="string"==typeof a&&/\/$/.test(a),p=0;p<e.length;p++){var s=e[p];if("string"==typeof s)o+=escapeString(s);else{var c=escapeString(s.prefix),u="(?:"+s.pattern+")";s.repeat&&(u+="(?:"+c+u+")*"),o+=u=s.optional?s.partial?c+"("+u+")?":"(?:"+c+"("+u+"))?":c+"("+u+")"}}return r||(o=(i?o.slice(0,-2):o)+"(?:\\/(?=$))?"),o+=n?"$":r&&i?"":"(?=\\/|$)",new RegExp("^"+o,flags(t))}export function pathToRegexp(e,t,r){return t=t||[],Array.isArray(t)?r=r||{}:(r=t,t=[]),e instanceof RegExp?regexpToRegexp(e,t):(Array.isArray(e)?arrayToRegexp:stringToRegexp)(e,t,r)}